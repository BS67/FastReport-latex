\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{styles}[2021/01/16 mes styles]


% =============================================================
% base packages
% =============================================================

\RequirePackage{xkeyval} %working with keys --> only one ProcessOptionsX, and every Options have to be with xkeyval
\RequirePackage{ifthen} 
\RequirePackage{etoolbox} % provides a lot of robusts commands, here for the toogle bool
%\RequirePackage{fmtcount}	%for  counters style

% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
% Package Options
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

\newtoggle{newchappage}

\DeclareOptionX{NewChapPage}{\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{newchappage}}{}}	%for chapter create new page or not 	
\DeclareOptionX{ChapPrefix}{\newcommand{\prechap}{#1}} % met un préfix devant le nom des chapitres, ex : Projet I
\DeclareOptionX{titlenum}{\newcommand{\titlenum}{#1}}%numérotation
\DeclareOptionX{fancytitle}{\newcommand{\fancytitle}{#1}}%savoir quel style de titre
\DeclareOptionX{fancypage}{\newcommand{\fancypage}{#1}}%savoir quel style de titre
\DeclareOptionX{logo}{\newcommand{\pathlogo}{#1}}%logo a mettre en entête
\DeclareOptionX{name}{\newcommand{\name}{{\begin{tabular}[b]{r@{}} #1 \end{tabular} }}}%noms à mettre en en-tête nom // nom ....
\ProcessOptionsX\relax

\providecommand{\prechap}{}
\providecommand{\name}{}
\providecommand{\num}{0}% if not defined, will be set to 1
\providecommand{\fancytitle}{0}% if not defined, will be set to 1
\providecommand{\fancypage}{0}% if not defined, will be set to 1
\providecommand{\pathlogo}{no}% if not defined, will be set to 1

% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
% MAIN
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
\PassOptionsToPackage{indentafter, pagestyles}{titlesec}%titre, entête et pied de page
\RequirePackage{titlesec}

%	==============================================================
%	title numerotation
% ==============================================================

\ifthenelse{\equal{\titlenum}{1}}
		{
			\makeatletter
			\renewcommand{\thechapter}{\@Roman\c@chapter.}
			\renewcommand{\thesection}{\@arabic\c@section}
			\renewcommand\thesubsection {\thesection.\@arabic\c@subsection}
			\renewcommand{\thesubsubsection}{\thesubsection.\@Alph\c@subsubsection}
			\renewcommand{\theparagraph}{\@alph\c@paragraph}
			\makeatother
		
		}{}



%	==============================================================
%	title styling
% ==============================================================

\ifthenelse{\equal{\prechap}{}}{\def\sufchap{~}}{\def\sufchap{ :~}}
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
\ifthenelse{\equal{\fancytitle}{1}}
		{
		%bericht MK Labor, titre tout en noir
			\titleformat{\chapter}% command
				[hang]% shape
				{\bf \Huge}% format
				{\prechap\thechapter\sufchap}% label
				{1pt}% sep
				{}% before-code
				[]% after-code
				
			\titleformat{\section} % command
				[hang] % shape
				{\sc \bfseries \LARGE } % format
				{\thesection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
				
			\titleformat{\subsection} % command
				[hang] % shape
				{\bf \itshape \Large } % format
				{\thesubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
				
			\titleformat{\subsubsection} % command
				[hang] % shape
				{\bfseries \slshape } % format
				{\thesubsubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code

			\titleformat{\paragraph} % command
				[runin] % shape
				{\bf \slshape } % format
				{} % label
				{1pt} % sep
				{} % before-code
				[~:~] % after-code
				
			%\titlespacing*{command}{left}{before-sep}{after-sep}[right-sepi] 
			\titlespacing*{\chapter}				{0cm}		{0cm}		{0.7cm}
			\titlespacing*{\section}				{0.5cm}	{1cm}		{0.7cm}
			\titlespacing*{\subsection}			{0.5cm}	{0.7cm}	{0.7cm}
			\titlespacing*{\subsubsection}		{0.5cm}	{0.3cm}	{0.5cm}
			\titlespacing*{\paragraph}			{0.7cm}	{\parskip}{3pt}%before=\parskip : longueur entre paragraph
		
		}{}
	
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
	\ifthenelse{\equal{\fancytitle}{2}}
		{
		%stage siemens
			\titleformat{\chapter}% command
				[hang]% shape
				{\bf \huge \color{MidnightBlue}}% format
				{\prechap\thechapter\sufchap}% label
				{1pt}% sep
				{}% before-code
				[]% after-code
				
			\titleformat{\section} % command
				[hang] % shape
				{\sc \bfseries \LARGE } % format
				{\thesection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
				
			\titleformat{\subsection} % command
				[hang] % shape
				{\bf \itshape \Large } % format
				{\thesubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
				
			\titleformat{\subsubsection} % command
				[hang] % shape
				{\bfseries \slshape } % format
				{\thesubsubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code

			\titleformat{\paragraph} % command
				[runin] % shape
				{\bf \slshape \color{MidnightBlue}} % format
				{\theparagraph} % label
				{1pt} % sep
				{} % before-code
				[~:~] % after-code
				
			%\titlespacing*{command}{left}{before-sep}{after-sep}[right-sepi] 
			\titlespacing*{\chapter}				{0cm}		{0cm}		{0.7cm}
			\titlespacing*{\section}				{0.5cm}	{1cm}		{0.7cm}
			\titlespacing*{\subsection}			{1cm}	{0.5cm}	{0.5cm}
			\titlespacing*{\subsubsection}		{2cm}	{0.5cm}	{0.5cm}
			\titlespacing*{\paragraph}			{0.7cm}	{\parskip}{3pt}%before=\parskip : longueur entre paragraph
		
		}{}
	% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
	\ifthenelse{\equal{\fancytitle}{3}}
		{	
		%bericht MK Labor, titre tout en noir + titres plus grands
			\titleformat{\chapter}% command
				[hang]% shape
				{\bf \huge}% format
				{\prechap\thechapter\sufchap}% label
				{1pt}% sep
				{}% before-code
				[]% after-code
			
			\titleformat{\section} % command
				[hang] % shape
				{\sc \bfseries \Large } % format
				{\thesection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
			
			\titleformat{\subsection} % command
				[hang] % shape
				{\bf \itshape \large } % format
				{\thesubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code
				
			\titleformat{\subsubsection} % command
				[hang] % shape
				{\large \bfseries \slshape \sc} % format
				{\thesubsubsection} % label
				{1cm} % sep
				{} % before-code
				[ ] % after-code

			\titleformat{\paragraph} % command
				[runin] % shape
				{\bf \slshape } % format
				{} % label
				{1pt} % sep
				{} % before-code
				[~:~] % after-code
}{}
%	==============================================================
%	page styling
% ==============================================================

\iftoggle{newchappage}{\let\newcpage\newpage}{\def\newcpage{}}
%attention peut causer des prob en twocolumn car les ifs ont été supprimé
\makeatletter
	%desactive mode empty page aux chapitres + newpage si besoin
	\renewcommand\chapter{\newcpage%
			\global\@topnum\z@%
			\@afterindentfalse%
			\secdef\@chapter\@schapter}
	%desactive mode plain page aux parties		
	\renewcommand\part{\clearpage%
			\null\vfil
			\secdef\@part\@spart}
			
\makeatother



\ifthenelse{\equal{\pathlogo}{no}}{%no logo avaible for page head
															\newcommand{\headlogo}{}
															}{%logo avaible for page head
															\newcommand{\headlogo}{\hfill\mbox{\includegraphics[width=0.3\textwidth]{\pathlogo}}}
															}	

									
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
\ifthenelse{\equal{\fancypage}{1}}
{
			%stylepage
		\newpagestyle{debut}{%
			\pagenumbering{Roman}
			\sethead{}{}{\headlogo}
			\setfoot{}{}{}
			\headrule
			\setheadrule{0.4pt}
			}

		\newpagestyle{main}{%
			\pagenumbering{arabic}
			\sethead{\fontsize{20pt}{0pt}\selectfont \scshape \thechapter\hspace{3mm}\chaptertitle}{}{\headlogo}
			\setfoot{}{\centering \thepage}{}
			\headrule
			\setheadrule{0.4pt}
			}
		
}{}
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$	
\ifthenelse{\equal{\fancypage}{2}}
{
			%stylepage
		\newpagestyle{debut}{%
			\pagenumbering{Roman}
			\sethead{\name}{}{\headlogo}
			\setfoot{}{}{}
			\headrule
			\setheadrule{0.4pt}
			}

		\newpagestyle{main}{%
			\pagenumbering{arabic}
			\sethead{\name}{}{\headlogo}
			\setfoot{}{\centering \thepage}{}
			\headrule
			\setheadrule{0.4pt}
			}
		
}{}

% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

\ifthenelse{\equal{\fancypage}{3}}
{
			%stylepage
		\newpagestyle{debut}{%
			\pagenumbering{Roman}
			\sethead{\fontsize{20pt}{0pt}\selectfont \scshape \thechapter\hspace{3mm}\chaptertitle}{}{\headlogo}
			\setfoot{}{\centering\Roman{page}}{}
			\headrule
			\setheadrule{0.4pt}
			}

		\newpagestyle{main}{%
			\pagenumbering{arabic}
			\sethead{\name}{}{\headlogo}
			\setfoot{}{\centering \thepage}{}
			\headrule
			\setheadrule{0.4pt}
			}
		
}{}
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

\ifthenelse{\equal{\fancypage}{4}}
{
			%stylepage
		\newpagestyle{debut}{%
			\pagenumbering{Roman}
			\sethead{\name}{}{\headlogo}
			\setfoot{}{\centering\Roman{page}}{}
			\headrule
			\setheadrule{0.4pt}
			}

		\newpagestyle{main}{%
			\pagenumbering{arabic}
			\sethead{\name}{}{\headlogo}
			\setfoot{}{\centering \thepage}{}
			\headrule
			\setheadrule{0.4pt}
			}
		
}{}