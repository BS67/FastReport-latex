\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{main}[2021/07/30 principal]






% =============================================================
% base packages
% =============================================================

\RequirePackage{xkeyval} %working with keys --> only one ProcessOptionsX, and every Options have to be with xkeyval
\RequirePackage{ifthen} 
\RequirePackage{etoolbox} % provides a lot of robusts commands, here for the toogle bool
\RequirePackage{fmtcount}	%for counters

% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
% Package Options
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$


\newtoggle{bib}
\newtoggle{svg}
\newtoggle{floatbarrier}
\newtoggle{link}
\newtoggle{quote}
\newtoggle{calc}
\newtoggle{showframe}
\newtoggle{acro}

\DeclareOptionX{math}{}%legacy version
\DeclareOptionX{font}[libertine]{\newcommand{\myfont}{#1}}
\DeclareOptionX{calc}{			\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{calc}}{}}
\DeclareOptionX{quote}{			\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{quote}}{}}
\DeclareOptionX{floatbarrier}{\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{floatbarrier}}{}}
\DeclareOptionX{link}{			\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{link}}{}}
\DeclareOptionX{svg}{				\ifthenelse{\equal{#1}{} \or \equal{#1}{true}}{\toggletrue{svg}}{}}
\DeclareOptionX{bibstyle}{ \newcommand{\mybibstyle}{#1}}
\DeclareOptionX{bib}{				\ifthenelse{\equal{#1}{no}}{}{\toggletrue{bib} \newcommand{\bibfile}{#1}}}
\DeclareOptionX{acro}{				\ifthenelse{\equal{#1}{no} }{}{\toggletrue{acro}}}
\DeclareOptionX{table}{			\newcommand{\mylistoftables}{\listoftables}}
\DeclareOptionX{spacing}{\newcommand{\textspacing}{#1}}
\DeclareOptionX{language}{\newcommand{\doclanguage}{#1}}
\DeclareOptionX{geometry}[1]{\newcommand{\fancygeometry}{#1}}
\DeclareOptionX{showframe}{\toggletrue{showframe}}

\DeclareOptionX*{\PackageError{main_package}{the entry #1 doesn't exist}}

\ProcessOptionsX\relax
\providecommand{\myfont}{libertine}
\providecommand{\fancygeometry}{1}
\providecommand{\textspacing}{1.5}% if not defined, will be set to 1.5
\providecommand{\mybibstyle}{unsrt}
\providecommand{\doclanguage}{fr}
\providecommand{\mylistoftables}{}
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
% MAIN
% $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

\iftoggle{showframe}{\RequirePackage{showframe}
\RequirePackage{widows-and-orphans} %indication ligne vide
}{}

% =============================================================
% raccourci de base
% =============================================================

\newcommand{\sbsec}{\subsection}
\newcommand{\sbbsec}{\subsubsection}
\newcommand{\para}{\paragraph*}
% =============================================================
% main Page style
% =============================================================


\PassOptionsToPackage{paper=a4paper}{geometry} 
\RequirePackage{geometry}
\ifthenelse{\equal{\fancygeometry}{1}}{
\newgeometry{tmargin=3cm,bmargin=3cm,lmargin=3cm,rmargin=1.5cm,headheight=100pt, headsep= 1cm, footskip=2cm}}{}
\ifthenelse{\equal{\fancygeometry}{2}}{
\newgeometry{tmargin=3cm,bmargin=3cm,lmargin=1.5cm,rmargin=1.5cm,headheight=100pt, headsep= 1cm, footskip=2cm}}{}


\savegeometry{normal}
\newgeometry{tmargin=0cm,bmargin=0cm,lmargin=1.5cm,rmargin=1.5cm,headheight=0cm, headsep=0cm}
\savegeometry{title}

% =============================================================
% text style
% =============================================================
\PassOptionsToPackage{document}{ragged2e} 
\RequirePackage{ragged2e} % permet un alignement du texte qui soit plus naturel avec les cmd: \Centering \RaggedLeft \RaggedRight
\RequirePackage{parskip}%pour avoir des parskip qui soient propre et qui ne donnent pas de trucs bizarre
\RequirePackage{multicol}

%paragraph spacing
\setlength{\parindent}{5ex}
\widowpenalties 1 10000 %evite les pagebreaks au milieu des paragraphes

%text interspacing 
\RequirePackage{setspace}
	\AfterEndPreamble{
		\ifthenelse{\equal{\textspacing}{1} }{
			\def\myspacing{\setstretch{1.2}} %baselinestretch => espace entre les deux lignes
			\setlength{\parskip}{4pt plus 2pt minus 2pt }  % sautre en paragraphes
			\setlist{itemsep = 1pt plus 1pt minus 1pt, parsep = 1pt plus 1pt minus 1pt} 
			% itemsep => entre les items d'une liste
			% parsep => entre les paragraphes de la liste
			\setlength{\abovedisplayskip}{10pt plus 2pt minus 5pt} % au dessus equation
			\setlength{\abovedisplayshortskip}{10pt plus 2pt minus 5pt} % au dessus equation
			\setlength{\belowdisplayshortskip}{10pt plus 2pt minus 5pt} % en dessous equation
			\setlength{\belowdisplayskip}{10pt plus 2pt minus 5pt} % en dessous equation
			\setlength{\intextsep}{7pt plus 5pt minus 3pt} % espace entre la figure + texte
			\setlength{\textfloatsep}{5pt plus 7pt minus 1pt} % espace entre le texte et l'espace des floats top et bottom
			% espace entre caption et images => gérer par le package caption 10 pt cst
			\setlength{\abovecaptionskip}{8pt plus 2pt minus 5pt} % espace entre le texte et caption => caption haut
			\setlength{\belowcaptionskip}{8pt plus 2pt minus 5pt} % espace entre texte et catpion => caption bas
		}{}
		\ifthenelse{\equal{\textspacing}{1.5} }{
			\def\myspacing{\setstretch{1}}
			\setlength{\parskip}{0pt plus 2pt } 
			\setlist{itemsep = 1pt plus 1pt minus 1pt, parsep = 2pt plus 1pt minus 1pt}
			\setlength{\abovedisplayskip}{2pt plus 2pt }
			\setlength{\abovedisplayshortskip}{2pt plus 2pt }
			\setlength{\belowdisplayshortskip}{2pt plus 2pt }
			\setlength{\belowdisplayskip}{2pt plus 2pt }
			\setlength{\intextsep}{2pt plus 5pt minus 3pt}
			\setlength{\textfloatsep}{2pt plus 7pt minus 1pt}
			\setlength{\abovecaptionskip}{6pt plus 2pt minus 5pt}
			\setlength{\belowcaptionskip}{6pt plus 2pt minus 5pt}
		}{}
		\ifthenelse{\equal{\textspacing}{2} }{
			\def\myspacing{\setstretch{1.5}}
			\setlength{\parskip}{10pt plus 3pt minus 3pt } 
			\setlist{itemsep = 0pt plus 1pt minus 1pt, parsep = 0pt plus 1pt minus 1pt}
			\setlength{\abovedisplayskip}{20pt plus 2pt minus 5pt}
			\setlength{\abovedisplayshortskip}{20pt plus 2pt minus 10pt}
			\setlength{\belowdisplayshortskip}{20pt plus 2pt minus 10pt}
			\setlength{\belowdisplayskip}{15pt plus 2pt minus 5pt}
			\setlength{\intextsep}{15pt plus 5pt minus 3pt}
			\setlength{\textfloatsep}{10pt plus 7pt minus 1pt}
			\setlength{\abovecaptionskip}{15pt plus 2pt minus 7pt}
			\setlength{\belowcaptionskip}{15pt plus 2pt minus 7pt}
		}{}	
\myspacing
\selectfont
}
%main font

\ifthenelse{\equal{\myfont}{libertine}}{\RequirePackage{libertine} \RequirePackage{courier}}{
	\ifthenelse{\equal{\myfont}{CM}}{}{
		\ifthenelse{\equal{\myfont}{KPF}}{\RequirePackage{kpfonts}}{
			\ifthenelse{\equal{\myfont}{Utopia}}{\RequirePackage{fourier}}{
				\ifthenelse{\equal{\myfont}{DejaVu}}{\RequirePackage{dejavu}}{
					\ifthenelse{\equal{\myfont}{Bookman}}{\RequirePackage{tgbonum}}{
		
					}
				}
			}
		}
	}

}



%for every unit: \DeclareSIUnit{\fahrenheit}{\degree F} \SI{nb}{unit}
\RequirePackage{siunitx}
\sisetup{ detect-all = true, binary-units = true , free-standing-units = true }
% Astronomy
\DeclareSIUnit\parsec{pc}
\DeclareSIUnit\lightyear{ly}
% Chemical engineering
\DeclareSIUnit\gmol{g\text{-}mol}
\DeclareSIUnit\kgmol{kg\text{-}mol}
\DeclareSIUnit\lbmol{lb\text{-}mol}
% Chemistry
\DeclareSIUnit\molar{\mole\per\cubic\deci\metre}
\DeclareSIUnit\Molar{\textsc{m}}
\DeclareSIUnit\torr{torr}
% Geophysics
\DeclareSIUnit\gon{gon}
% High energy physics
\DeclareSIUnit\micron{\micro\metre}
\DeclareSIUnit\mrad{\milli\rad}
\DeclareSIUnit\gauss{G}
\DeclareSIUnit\eVperc{\eV\per\clight}
\DeclareSIUnit\nanobarn{\nano\barn}
\DeclareSIUnit\picobarn{\pico\barn}
\DeclareSIUnit\femtobarn{\femto\barn}
\DeclareSIUnit\attobarn{\atto\barn}
\DeclareSIUnit\zeptobarn{\zepto\barn}
\DeclareSIUnit\yoctobarn{\yocto\barn}
\DeclareSIUnit\nb{\nano\barn}
\DeclareSIUnit\pb{\pico\barn}
\DeclareSIUnit\fb{\femto\barn}
\DeclareSIUnit\ab{\atto\barn}
\DeclareSIUnit\zb{\zepto\barn}
\DeclareSIUnit\yb{\yocto\barn}

%images
\DeclareSIUnit\px{px}
%Industry
\DeclareSIUnit{\dBm}{dBm}%decibel milliwatt
\DeclareSIUnit{\dBV}{dBV}%decibel volt


%	==============================================================
%	figure, table, equation
% ==============================================================

\RequirePackage{graphics}
\PassOptionsToPackage{dvips}{graphicx}
\PassOptionsToPackage{svgnames}{xcolor}%donne des couleurs, ex: Midnightblue
\RequirePackage{graphicx,xcolor}
\RequirePackage{subcaption} %create cmd to make subcaption easyer

\usepackage{diagbox} %diagonale in tables \diagbox{r}{l}
\RequirePackage{multirow} %: 
	%\multicolumn{nomb_col}{alignement ex:|c|}{contenu} 
	%\multirow{nomb_ligne}{largeur ex * }{contenu qui est 1 fusionné}

\usepackage{hhline}% pour lignes ====
\RequirePackage{array}
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}

%caption pour tableau, figure, subfigure
\RequirePackage{caption}
		\captionsetup[table]{justification=centering, format=hang,  labelfont={sc,tt}, textfont={bf,sl,tt},skip=8pt, position=above, labelsep=colon}
		\captionsetup[figure]{justification=centering, format=hang, labelfont={sc,tt}, textfont={bf,sl,tt},skip=8pt, position=bottom, labelsep=colon}	
		\captionsetup[sub]{justification=centering, format=hang, labelfont={sc,tt}, textfont={bf,sl,tt},skip=8pt, labelsep=colon}

\def\brcaption{\hspace{\textwidth}}

%compteur, met le num du chapitre aussi

\renewcommand{\thefigure}{\arabic{chapter}.\arabic{figure}}
\renewcommand{\thetable}{\arabic{chapter}.\arabic{table}}
\renewcommand{\thesubfigure}{\Alph{subfigure}}	

\ifthenelse{\equal{\doclanguage}{fr}}{\def\sourcename{Source}}{}
\ifthenelse{\equal{\doclanguage}{de}}{\def\sourcename{Quelle}}{}
\ifthenelse{\equal{\doclanguage}{en}}{\def\sourcename{Source}}{}


\newcommand{\source}[1]{\vspace{-3pt}\caption*{\sourcename:~ {#1}} }
%	==============================================================
%	structure dans float
% ==============================================================

% divise la page en 2 
%!!!! pas dans figure !!!
\newcommand\twopic[2]{
\hspace{-1cm}
\begin{minipage}[m]{0.5\textwidth}\centering#1 \end{minipage}%
\begin{minipage}[m]{0.5\textwidth}\centering#2 \end{minipage}
}

%regarder dans geometry pour trouver l'offset --> package automatique
\newcommand\sidecap[2]{
\begin{figure}[H]
	\hspace{-1cm}\begin{minipage}[m]{0.8\textwidth}\centering#1 \end{minipage}%
	\nolinebreak\hspace{0.5cm}\begin{minipage}[m]{0.3\textwidth} \small #2 \end{minipage}
\end{figure}
}

%\sidecap{img+caption...}{description}

% ===============================================================
% float & text repartition & floatbarrier
% ==============================================================
\iftoggle{floatbarrier}{ 

	\PassOptionsToPackage{section, above}{placeins}
	\RequirePackage{placeins}%\FloatBarrier

	\newcommand{\floatprotec}[2]{\FloatBarrier #1{#2} \FloatBarrier} %float barrier pour section automatique
	\renewcommand{\sbsec}{\floatprotec{\subsection}}
	%\renewcommand{\sbbsec}{\floatprotec{\subsubsection}}

	\let\saveFloatBarrier\FloatBarrier	
	\newcommand{\desactivatefloatbarrier}{\let\FloatBarrier\relax}	
	\newcommand{\reactivatefloatbarrier}{\let\FloatBarrier\saveFloatBarrier}
}{}

\RequirePackage{float} %[H]

%partie text vs float
% [H] ici !
%[!h] ici si ca passe


\renewcommand\topfraction{0.6}% un float en haut de page a le droit de faire 60% de pageheight
\renewcommand\textfraction{0.2}%il faut au 20% de la hauteur de la page qui soit occupé de texte pur
\renewcommand\floatpagefraction{0.8}%ratio pour que une page occupé par un float devienne une page pur float

%	==============================================================
%	print table
% ==============================================================
\providecommand{\listofappendixs}{}% si pas le package qui va avec
\providecommand{\biblio}{}%si pas de bibliographie
\providecommand{\lstlistoflistings}{ }
\providecommand{\listofalgorithms}{ }
\providecommand{\acrolist}{ }

\patchcmd{\listoffigures}{\chapter*}{\section}{}{}
\patchcmd{\listoftables}{\chapter*}{\section}{}{}


% ---------------------------------
% table print title language
% ---------------------------------
\ifthenelse{\equal{\doclanguage}{fr}}{\newcommand*{\tabletitle}{Listes \& Tables}}{}
\ifthenelse{\equal{\doclanguage}{de}}{\newcommand*{\tabletitle}{Verzeichnisse}}{}
\ifthenelse{\equal{\doclanguage}{en}}{\newcommand*{\tabletitle}{Tables}}{}


\newcommand\tablestart{
	\let\oldprechap\prechap
	\let\oldsufchap\sufchap
	\def\sufchap{~}% supprimer une quelconque mise en forme provenant du style package
	\def\prechap{}%dans style package
	\chapter{\tabletitle}
	\acrolist \filbreak
	\listoffigures \filbreak
	\mylistoftables \filbreak
	\lstlistoflistings \filbreak
	\listofalgorithms \filbreak
	\listofappendixs 
	\let\prechap\oldprechap
	\let\sufchap\oldsufchap
	}
	

\newcommand\tableend{
	\let\bibtitle\chapter
	\biblio
}

\newcommand\tables{
\def\sufchap{~}% supprimer une quelconque mise en forme provenant du style package
\def\prechap{}%dans style package
	\chapter{\tabletitle}
	\acrolist \filbreak
	\listoffigures \filbreak
	\mylistoftables \filbreak
	\lstlistoflistings \filbreak
	\listofalgorithms \filbreak
	\listofappendixs \filbreak
	\biblio
}

\setcounter{secnumdepth}{6}
\setcounter{tocdepth}{5}








%	==============================================================
%  svg
% ==============================================================


\iftoggle{svg}{
		\immediate\write18{svgtopng.exe}%transform every svg in svg/.png

}{}
	

	
%	==============================================================
%	enumerations
% ==============================================================		
\PassOptionsToPackage{inline}{enumitem}
\RequirePackage{enumitem}%parametrer enumeration
%liste
%les listes * on le même paramétrage que les listes normales

\setlist[enumerate]{ topsep = 0mm, labelindent=5pt, label= \arabic*.,font=\bfseries}

\setlist[description]{ topsep = 0mm, labelindent=5pt }
\setlist[itemize]{ topsep = 0mm, labelindent=5pt, label=\textbullet }	

%2 nouveaux formats pour des subliste
\newcommand{\doublepoint}[1]{{\bfseries #1 ~:~}}
\SetEnumitemKey{compact}{noitemsep,nolistsep}
\SetEnumitemKey{dp}{font=\doublepoint, labelindent=1cm,leftmargin = 1.5cm, itemindent=-0.5cm}
\SetEnumitemKey{sblist}{labelindent=1cm, leftmargin = *,label= \alph*)}
\SetEnumitemKey{sbblist}{labelindent=1.5cm, leftmargin = *,label= \textit{(\roman*)}}
\makeatletter
	\@beginparpenalty=1000 % high penality -> do not encourage break
	\@itempenalty=4000% high penality -> do not encourage break
	\@endparpenalty=1% low penality ->  encourage break
\makeatother
%	==============================================================
%	langue & typesettings
% ==============================================================
	\PassOptionsToPackage{T1}{fontenc}
\RequirePackage{fontenc}
	\PassOptionsToPackage{utf8}{inputenc}
\RequirePackage{inputenc}
	

			\ifthenelse{\equal{\doclanguage}{fr}}
			{%option is french
					\PassOptionsToPackage{french}{babel}
					\PassOptionsToPackage{french}{isodate}
			}{
			\ifthenelse{\equal{\doclanguage}{de}}
			{%option is german
					\PassOptionsToPackage{ngerman}{babel}
					\PassOptionsToPackage{german}{isodate}
			}{
			\ifthenelse{\equal{\doclanguage}{en}}
			{%option is english
					\PassOptionsToPackage{english}{babel}
					\PassOptionsToPackage{english}{isodate}
			}
			{
			\PackageError{main-package}{you didn't choosed a language}{package options: fr, de, en}
			}}}		

	
	\RequirePackage{babel}
	\RequirePackage{isodate} % dateprint: https://ctan.org/pkg/isodate

%	==============================================================
%	maths
% ==============================================================

%compteur, rajoute le num du chapitre 
\renewcommand{\theequation}{\arabic{chapter}.\arabic{equation}}

	\newcommand{\inlineeqlabel}[1]{\refstepcounter{equation}(\theequation)\label{#1}}


%compteur pour exercice
\ifthenelse{\equal{\doclanguage}{fr}}{\def\exercice{Exercice}}{}
\ifthenelse{\equal{\doclanguage}{de}}{\def\exercice{Aufgabe}}{}
\ifthenelse{\equal{\doclanguage}{en}}{\def\exercice{Exercice}}{}


	\newcounter{exo}
		\setcounter{exo}{0}
		\newcommand{\exosuivant}
		{
			\addtocounter{exo}{1}
			\vp\noindent{\bf \exercice {\theexo}.\\ }
		}

		
		
	\PassOptionsToPackage{fleqn}{amsmath}
	\PassOptionsToPackage{allowspaces}{mathtools} %https://ctan.crest.fr/tex-archive/macros/latex/contrib/mathtools/mathtools.pdf
	\RequirePackage{amsmath,amssymb,amsfonts, mathtools}%mathtools très très puissant voir si problème il y a enormément de chose
	
\providecommand\eq[1]{\begin{align}#1\end{align}} %equations
\providecommand\noeq[1]{\begin{align*}#1\end{align*}}
		
\mathtoolsset{showonlyrefs}
\usetagform{default}

\providecommand{\bc}{\begin{dcases}} 
\providecommand{\ec}{\end{dcases}}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\hvect{[}{]^T}

\newcommand{\mb}{\mathbf}


\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\K}{\mathbb{K}}
\newcommand{\U}{\mathbb{U}}
\newcommand{\Mn}{\mathcal{M}_n}
\newcommand{\M}{\mathcal{M}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\F}{\mathcal{F}}
\renewcommand{\L}{\mathcal{L}}
	
			
			%equations
			
			

			
	
		\iftoggle{calc}{
							\RequirePackage{calculator}% faire des calculs avec latex
						}{}
			
%	==============================================================
%	footnote
% ==============================================================
%protecting: etoolbox robust cmd
					
\newcommand{\fnm}{\footnotemark~}
\newcommand{\pnm}{\protecting{\footnotemark}~} % a utiliser dans ce qui est écrit dans les tables 
\newcommand{\fnt}{\footnotetext}
\usepackage{tablefootnote}
					
				
%	==============================================================
%	quote
% ==============================================================	
\iftoggle{quote}{
					\PassOptionsToPackage{autostyle, csdisplay=true}{csquotes} %enquote{}
					\RequirePackage{csquotes} 
					%bcp bcp d'option aller regarder: https://mirror.ibcp.fr/pub/CTAN/macros/latex/contrib/csquotes/csquotes.pdf
				\RequirePackage{epigraph} % sectional heading: https://mirrors.chevalier.io/CTAN/macros/latex/contrib/epigraph/epigraph.pdf
				
				
				\ifthenelse{\equal{\doclanguage}{fr}}{\setquotestyle[quotes]{french}}{}
				\ifthenelse{\equal{\doclanguage}{de}}{\setquotestyle[quotes]{german}}{}
				\ifthenelse{\equal{\doclanguage}{en}}{}{}%per default ? I suppose it's set with autostyle
				
				
}{}
		



%	==============================================================
%	bibtex
% ==============================================================

\iftoggle{bib}{
					
					\PassOptionsToPackage{
						sorting = count, %trie les references par nombre de passage
						date = short, %format de la date
						url = true,
						hyperref=true,
						citestyle = numeric-comp, %format des references [1–3, 7, 8]
						bibstyle = numeric,
						backend=biber,
						url=false,
						maxnames=2,
						eprint=false
						}{biblatex} %enquote{}
					
						\RequirePackage{biblatex}

					\let\bibtitle\section
					\defbibheading{bibliography}[\bibname]{
						\bibtitle{#1}
						%\markboth{#1}{#1}
						}
						
					\addbibresource{\bibfile}
					\renewcommand*{\bibfont}{\small}

					\AtEveryBibitem{
							\clearfield{month}
							\clearfield{series}
							\clearfield{venue}
							\clearname{editor}
							\clearlist{publisher}
							\clearlist{location} % alias to field 'address'
							%\clearfield{doi}
							\clearfield{url}
							\clearfield{venue}
							\clearfield{issn}
							\clearfield{isbn}
							\clearfield{urldate}
							%\clearfield{eventdate}
							\clearfield{pages}
							\clearfield{booktitle}
							\clearfield{journaltitle}
							\clearfield{number}
							\clearfield{volume}
							\clearlist{language}
							\clearlist{langid}
							}

					\def\biblio{ 
							\clearpage
							
							% \bibliographystyle{\mybibstyle}
							% \bibliography{\bibfile}
							\printbibliography
					}
					
}{}

%	==============================================================
%	spaces
% ==============================================================	
\newcommand{\emptypage}{
												\newpage
												\strut
												\newpage
											 }

% espaces verticaux et horizontaux
	\newcommand{\vp}{\vspace{0.2cm}\newline}
	\newcommand{\vpp}{\vspace{0.1cm}\newline}
	\newcommand{\vg}{\vspace{0.4cm}\newline}

	\newcommand{\br}{\newline \indent}



%	==============================================================
%	link -> hyperref toujours a la fin
% ==============================================================
	
\iftoggle{link}{
		\PassOptionsToPackage{hyphens}{url}							%sinon prob de cohésion entre hyperrref et {hyphen}url pour que les longues url breaks 
		\PassOptionsToPackage{urlcolor=cyan,pdftex}{hyperref}
		\RequirePackage{url}
		\RequirePackage{hyperref}	
			\def\UrlBreaks{\do\.\do\@\do\\\do\/\do\!\do\_\do\|\do\;\do\>%
			\do\]\do\)\do\,\do\?\do\'\do+\do\=\do\#\do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z%
			\do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X\do\Y\do\Z%
			\do\1\do\2\do\3\do\4\do\5\do\6\do\7\do\8\do\9\do\%\do\=}%

	\newcommand{\refA}[2]{\hyperlink{#1B}{\hypertarget{#1A}{#2}}}
	\newcommand{\refB}[2]{\hypertarget{#1B}{\hyperlink{#1A}{#2}}}
	\let\oldurl\url
	\renewcommand{\url}[2]{\href{#1}{#2}}
}{}

\let\oldref\ref
\renewcommand{\ref}{ \oldref} %ajoute un espace avant		

% ==============================================================
%  Acronyms
% ==============================================================
\iftoggle{acro}{


	\usepackage[acronym,nonumberlist,style=list,nopostdot]{glossaries}

	\ifthenelse{\equal{\doclanguage}{fr}}{\newcommand*{\acrotitle}{Acronymes}}{}
	\ifthenelse{\equal{\doclanguage}{de}}{\newcommand*{\acrotitle}{Abkürzungen}}{}
	\ifthenelse{\equal{\doclanguage}{en}}{\newcommand*{\acrotitle}{Acronyms}}{}

	\makenoidxglossaries
	\renewcommand{\glossarysection}[2][]{} % supprime le titre
	\def\acrolist{
		\section{\acrotitle}
		\begin{multicols}{3}
			\printnoidxglossary[type=\acronymtype]
		\end{multicols}
	}
}{}